# ===========================================
# Development Docker Compose Override
# ===========================================
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d
# Or simply: docker-compose --profile dev up -d

version: '3.8'

services:
  # ===========================================
  # Development App Configuration
  # ===========================================
  app:
    build:
      context: .
      dockerfile: Dockerfile.dev
    volumes:
      # Mount source code for hot reloading
      - .:/var/www/html:cached
      # Persist node_modules and vendor in named volumes for performance
      - dev_vendor:/var/www/html/vendor
      - dev_node_modules:/var/www/html/node_modules
    environment:
      - APP_ENV=local
      - APP_DEBUG=true
      - OPCACHE_VALIDATE_TIMESTAMPS=1

  # ===========================================
  # Node.js for Vite HMR (Hot Module Replacement)
  # ===========================================
  node:
    image: node:20-alpine
    container_name: web_booking_node
    working_dir: /var/www/html
    ports:
      - "5173:5173"
    volumes:
      - .:/var/www/html:cached
      - dev_node_modules:/var/www/html/node_modules
    command: sh -c "npm install && npm run dev -- --host 0.0.0.0"
    networks:
      - web_booking_network

volumes:
  dev_vendor:
    driver: local
  dev_node_modules:
    driver: local

